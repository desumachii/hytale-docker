FROM openjdk:22-jdk-slim

# Create the hytale directory if it doesn't exist
RUN mkdir -p /hytale

# Go to the hytale directory
WORKDIR /hytale

# Set the downloader URL
ENV DOWNLOADER_URL=https://downloader.hytale.com/hytale-downloader.zip

# Install unzip and wget
RUN apt-get update && apt-get install -y unzip wget

# Download the downloader
RUN wget -O hytale-downloader.zip $DOWNLOADER_URL

# Unzip the downloader
RUN unzip hytale-downloader.zip

# Rename the downloader to hytale-downloader
RUN mv hytale-downloader-linux-amd64 hytale-downloader

# Delete the Windows downloader
RUN rm hytale-downloader-windows-amd64.exe

# Execute it
RUN ./hytale-downloader

# Clean up
RUN rm hytale-downloader.zip

# Expose the port
EXPOSE 5520

# Run the server
CMD ["/entrypoint.sh"]